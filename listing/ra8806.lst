C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 1   


C51 COMPILER V7.50, COMPILATION OF MODULE RA8806
OBJECT MODULE PLACED IN .\output\ra8806.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE source\ra8806.c LARGE BROWSE INCDIR(.\include\) DEBUG OBJECTEXTEND PRINT(.\
                    -listing\ra8806.lst) OBJECT(.\output\ra8806.obj)

line level    source

   1          /***************************************************************************/
   2          // 程序：清洗设备控制器
   3          // 模块：液晶驱动
   4          // 文件：ra8806.c
   5          // 作者：卜晓D
   6          // 版本：V0.02
   7          // 日期：2013年11月8日
   8          // 功能：液晶驱动
   9          // 芯片：STC12C5A60S2
  10          // 编译：Keil uVision3 V3.90
  11          /***************************************************************************/
  12          
  13          #include <reg52.h>
  14          #include <basefunc.h>
  15          #include <fonts.h>
  16          #include <ra8806.h> 
  17          #include <parameter.h>
  18          
  19          /***************************************************************************/
  20          // 液晶引脚定义 
  21          /***************************************************************************/
  22          #define lcd_data P0
  23          sbit REST       = P2^7;   // REST就是接口中的RST
  24          sbit BUSY       = P2^6;   //BUSY就是接口中的BUSY
  25          sbit CS         = P2^5;   // CS就是接口中的CS1
  26          sbit RD0        = P2^4;  // RD0就是接口中的RD
  27          sbit WR0        = P2^3;  // WR0就是接口中的WR
  28          sbit CD         = P2^2;   // CD 就是接口中的RS
  29          
  30          
  31          
  32          
  33          
  34          
  35          /***************************************************************************/
  36          // 液晶写入命令函数
  37          // 参数：命令
  38          // 返回值：无   
  39          /***************************************************************************/
  40          void LCD_CmdWrite(uchar cmd)
  41          {
  42   1              CS=0;
  43   1              RD0 = 1;
  44   1              CD = 1;         
  45   1              WR0 = 0;
  46   1              lcd_data = cmd;
  47   1              //delay_us(2); 
  48   1              WR0 = 0;
  49   1              WR0 = 1;
  50   1              CS = 1;
  51   1      }
  52          
  53          /***************************************************************************/
  54          // 液晶写入数据函数
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 2   

  55          // 参数：数据
  56          // 返回值：无   
  57          /***************************************************************************/
  58          void LCD_DataWrite(uchar wdata)
  59          {
  60   1              while(!BUSY);
  61   1              CS=0;
  62   1              RD0 = 1;
  63   1              CD = 0;         
  64   1              lcd_data = wdata; 
  65   1              WR0 = 0;
  66   1              //delay_us(10); 
  67   1              WR0 = 1;
  68   1              CS = 1;
  69   1      }
  70          
  71          /***************************************************************************/
  72          // 液晶读取命令函数
  73          // 参数：地址
  74          // 返回值：命令
  75          /***************************************************************************/
  76          uchar LCD_CmdRead(uchar Addr)
  77          {  
  78   1              uchar Data;  
  79   1              CS=0;
  80   1              CD=1;
  81   1              RD0=1;
  82   1              lcd_data=Addr;
  83   1              WR0=0;
  84   1              WR0=1;
  85   1              lcd_data=0XFF;
  86   1              CD=0;
  87   1              WR0=1;
  88   1              RD0=1;
  89   1              RD0=0;
  90   1              Data=lcd_data;
  91   1              return Data;
  92   1      }
  93          
  94          /***************************************************************************/
  95          // 液晶读取数据函数
  96          // 参数：无
  97          // 返回值：数据
  98          /***************************************************************************/
  99          uchar LCD_DataRead()
 100          {
 101   1              uchar Data;
 102   1              lcd_data = 0x00;
 103   1              WR0 = 1;
 104   1              CS = 0;
 105   1              CD  = 0;
 106   1              RD0 = 0;
 107   1              Data = lcd_data;
 108   1              RD0 = 1;        
 109   1              CS = 1;                 
 110   1              //CD = 1;
 111   1              lcd_data = 0xff;
 112   1              return Data;
 113   1      }
 114          
 115          /***************************************************************************/
 116          // 液晶初始化函数
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 3   

 117          // 参数：无
 118          // 返回值：无
 119          /***************************************************************************/
 120          void lcd_inital()
 121          { 
 122   1              REST = 0;
 123   1              delay_ms(50);
 124   1              REST = 1;
 125   1              delay_ms(50);
 126   1              LCD_CmdWrite(WLCR);             //[00H] , Default --> 0x00
 127   1              LCD_DataWrite(0x04);
 128   1              
 129   1              LCD_CmdWrite(MISC);             //[01H] , Default --> 0x00
 130   1              LCD_DataWrite(0x08);
 131   1              
 132   1              LCD_CmdWrite(ADSR);             //[03H] , Default --> 0x00 
 133   1              LCD_DataWrite(0x00);
 134   1              
 135   1              LCD_CmdWrite(INTR);             //[0FH] , Default --> 0x00
 136   1              LCD_DataWrite(0x00);
 137   1              
 138   1              LCD_CmdWrite(WCCR);             //[10H] , Default --> 0x00
 139   1              LCD_DataWrite(0x00);
 140   1              
 141   1              LCD_CmdWrite(CHWI);             //[11H] , Default --> 0x00
 142   1              LCD_DataWrite(0x00);
 143   1              
 144   1              LCD_CmdWrite(MAMR);             //[12H] , Default --> 0x11 
 145   1              LCD_DataWrite(0x11);
 146   1              
 147   1              LCD_CmdWrite(AWRR);             //[20H] , Default --> 0x27
 148   1              LCD_DataWrite(39);
 149   1              
 150   1              LCD_CmdWrite(DWWR);             //[21H] , Default --> 0x27
 151   1              LCD_DataWrite(39);
 152   1              
 153   1              LCD_CmdWrite(AWBR);             //[30H] , Default --> 0xEF      
 154   1              LCD_DataWrite(239);
 155   1              
 156   1              LCD_CmdWrite(DWHR);             //[31H] , Default --> 0xEF
 157   1              LCD_DataWrite(239);
 158   1              
 159   1              LCD_CmdWrite(AWLR);             //[40H] , Default --> 0x00
 160   1              LCD_DataWrite(0x00);
 161   1              
 162   1              LCD_CmdWrite(AWTR);             //[50H] , Default --> 0x00
 163   1              LCD_DataWrite(0x00);
 164   1              
 165   1              LCD_CmdWrite(CURX);             //[60H] , Default --> 0x00 
 166   1              LCD_DataWrite(0x00);
 167   1              
 168   1              LCD_CmdWrite(BGSG);             //[61H] , Default --> 0x00
 169   1              LCD_DataWrite(0x00);
 170   1              
 171   1              LCD_CmdWrite(EDSG);             //[62H] , Default --> 0x00
 172   1              LCD_DataWrite(0x00);
 173   1              
 174   1              LCD_CmdWrite(CURY);             //[70H] , Default --> 0x00
 175   1              LCD_DataWrite(0x00);
 176   1              
 177   1              LCD_CmdWrite(BGCM);             //[71H] , Default --> 0x00
 178   1              LCD_DataWrite(0x00);
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 4   

 179   1              
 180   1              LCD_CmdWrite(EDCM);             //[72H] , Default --> 0x00
 181   1              LCD_DataWrite(0x00);
 182   1              
 183   1              LCD_CmdWrite(BTMR);             //[80H] , Default --> 0x00
 184   1              LCD_DataWrite(0x00);
 185   1              
 186   1              LCD_CmdWrite(ITCR);             //[90H] , Default --> 0x00    需要调整
 187   1              LCD_DataWrite(0x80);
 188   1              
 189   1              LCD_CmdWrite(PNTR);             //[E0H] , Default --> 0x00
 190   1              LCD_DataWrite(0x00);
 191   1              
 192   1              LCD_CmdWrite(FNCR);             //[F0H] , Default --> 0x00
 193   1              LCD_DataWrite(0x00);
 194   1              
 195   1              LCD_CmdWrite(FVHT);             //[F1H] , Default --> 0x00
 196   1              LCD_DataWrite(0x00);
 197   1      }
 198          
 199          /***************************************************************************/
 200          // 液晶X,Y坐标定位
 201          // 参数：x坐标  y坐标
 202          // 返回值：无
 203          /***************************************************************************/
 204          void LCD_GotoXY(uchar xx,uchar yy)
 205          {
 206   1              LCD_CmdWrite(CURX); 
 207   1              LCD_DataWrite(xx);
 208   1              LCD_CmdWrite(CURY);  
 209   1              LCD_DataWrite(yy);
 210   1      }
 211          
 212          /***************************************************************************/
 213          // 液晶绘图模式
 214          // 参数：无
 215          // 返回值：无
 216          /***************************************************************************/
 217          void LCD_Graphic(void)
 218          {
 219   1              uchar temp;
 220   1              temp=LCD_CmdRead(WLCR);
 221   1              temp &=0xf7;
 222   1              LCD_CmdWrite(WLCR);
 223   1              LCD_DataWrite(temp); 
 224   1      }
 225          
 226          /***************************************************************************/
 227          // 液晶文字模式
 228          // 参数：无
 229          // 返回值：无
 230          /***************************************************************************/
 231          void LCD_Text(void)
 232          {
 233   1              uchar temp;
 234   1              temp=LCD_CmdRead(WLCR);
 235   1              temp |=0x08;
 236   1              LCD_CmdWrite(WLCR);
 237   1              LCD_DataWrite(temp); 
 238   1      }
 239          
 240          /***************************************************************************/
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 5   

 241          // 液晶DDRAM1 显示
 242          // 参数：无
 243          // 返回值：无
 244          /***************************************************************************/
 245          void Only_Show_Page1(void)
 246          {
 247   1              uchar temp;
 248   1              temp=LCD_CmdRead(MAMR);
 249   1              temp &=0x9f;
 250   1              temp |=0x10;
 251   1              LCD_CmdWrite(MAMR);
 252   1              LCD_DataWrite(temp); 
 253   1      }
 254          
 255          /***************************************************************************/
 256          // 液晶DDRAM2 显示
 257          // 参数：无
 258          // 返回值：无
 259          /***************************************************************************/
 260          void Only_Show_Page2(void)
 261          {
 262   1              uchar temp;
 263   1              temp=LCD_CmdRead(MAMR);
 264   1              temp &=0xaf;
 265   1              temp |=0x20;
 266   1              LCD_CmdWrite(MAMR);
 267   1              LCD_DataWrite(temp); 
 268   1      }
 269          
 270          /***************************************************************************/
 271          // 液晶DDRAM1和DDRAM2 双图层显示
 272          // 参数：无
 273          // 返回值：无
 274          /***************************************************************************/
 275          void Show_Two_Layer(void)
 276          {
 277   1              uchar temp;     
 278   1              temp=LCD_CmdRead(MAMR);
 279   1              temp &=0xbf;
 280   1              temp |=0x30;
 281   1              LCD_CmdWrite(MAMR);
 282   1              LCD_DataWrite(temp); 
 283   1      }
 284          
 285          /***************************************************************************/
 286          // 液晶DDRAM1和DDRAM2 OR方式显示
 287          // 参数：无
 288          // 返回值：无
 289          /***************************************************************************/
 290          void OR_Two_Layer(void)
 291          {
 292   1              uchar temp;     
 293   1              temp=LCD_CmdRead(MAMR);
 294   1              temp &=0xf3;
 295   1              LCD_CmdWrite(MAMR);
 296   1              LCD_DataWrite(temp); 
 297   1      }
 298          
 299          /***************************************************************************/
 300          // 液晶DDRAM1和DDRAM2 XOR方式显示
 301          // 参数：无
 302          // 返回值：无
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 6   

 303          /***************************************************************************/
 304          void XOR_Two_Layer(void)
 305          {
 306   1              uchar temp;     
 307   1              temp=LCD_CmdRead(MAMR);
 308   1              temp &=0xf7;
 309   1              temp |=0x04;
 310   1              LCD_CmdWrite(MAMR);
 311   1              LCD_DataWrite(temp); 
 312   1      }
 313          
 314          /***************************************************************************/
 315          // 液晶DDRAM1和DDRAM2 NOR方式显示
 316          // 参数：无
 317          // 返回值：无
 318          /***************************************************************************/
 319          void NOR_Two_Layer(void)
 320          {
 321   1              uchar temp;     
 322   1              temp=LCD_CmdRead(MAMR);
 323   1              temp &=0xfb;
 324   1              temp |=0x08;
 325   1              LCD_CmdWrite(MAMR);
 326   1              LCD_DataWrite(temp); 
 327   1      }
 328          
 329          /***************************************************************************/
 330          // 液晶DDRAM1和DDRAM2 AND方式显示
 331          // 参数：无
 332          // 返回值：无
 333          /***************************************************************************/
 334          void AND_Two_Layer(void)
 335          {
 336   1              uchar temp;     
 337   1              temp=LCD_CmdRead(MAMR);
 338   1              temp |=0x0c;
 339   1              LCD_CmdWrite(MAMR);
 340   1              LCD_DataWrite(temp); 
 341   1      }
 342          
 343          /***************************************************************************/
 344          // 液晶存取DDRAM1
 345          // 参数：无
 346          // 返回值：无
 347          /***************************************************************************/
 348          void Access_Page1(void)
 349          {
 350   1              uchar temp;     
 351   1              temp=LCD_CmdRead(MAMR);
 352   1              temp &=0xfd;
 353   1              temp |=0x01;
 354   1              LCD_CmdWrite(MAMR);
 355   1              LCD_DataWrite(temp); 
 356   1      }
 357          
 358          /***************************************************************************/
 359          // 存取DDRAM2
 360          // 参数：无
 361          // 返回值：无
 362          /***************************************************************************/
 363          void Access_Page2(void)
 364          {
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 7   

 365   1              uchar temp;     
 366   1              temp=LCD_CmdRead(MAMR);
 367   1              temp &=0xfe;
 368   1              temp |=0x02;
 369   1              LCD_CmdWrite(MAMR);
 370   1              LCD_DataWrite(temp); 
 371   1      }
 372          
 373          /***************************************************************************/
 374          // 液晶清屏
 375          // 参数：无
 376          // 返回值：无
 377          /***************************************************************************/
 378          void clear(void)
 379          { 
 380   1              LCD_Graphic();     //选择绘图模式     
 381   1              LCD_CmdWrite(PNTR);
 382   1              LCD_DataWrite(0x00);
 383   1              LCD_CmdWrite(FNCR);
 384   1              LCD_DataWrite(0xa8);
 385   1              //delay_ms(3);
 386   1      }
 387          
 388          
 389          /***************************************************************************/
 390          // 液晶满屏显示
 391          // 参数：无
 392          // 返回值：无
 393          /***************************************************************************/
 394          void display_all()
 395          {
 396   1              LCD_Graphic();
 397   1              LCD_CmdWrite(PNTR);
 398   1              LCD_DataWrite(0xff);     //全部填0xff
 399   1              LCD_CmdWrite(FNCR);
 400   1              LCD_DataWrite(0xa8);
 401   1              //delay_ms(3);
 402   1      }
 403          
 404          /***************************************************************************/
 405          // 液晶全屏正常显示
 406          // 参数：无
 407          // 返回值：无
 408          /***************************************************************************/
 409          void normal_data(void)
 410          {
 411   1              uchar temp;
 412   1              temp=LCD_CmdRead(WLCR);  //读WLCR寄存器数据
 413   1              temp &=0xfe;
 414   1              LCD_CmdWrite(WLCR);
 415   1              LCD_DataWrite(temp);     
 416   1      }
 417          
 418          /***************************************************************************/
 419          // 液晶全屏反白显示
 420          // 参数：无
 421          // 返回值：无
 422          /***************************************************************************/
 423          void reverse_data(void)
 424          {
 425   1              uchar temp;
 426   1              temp=LCD_CmdRead(WLCR);  //读WLCR寄存器数据
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 8   

 427   1              temp |=0x01;
 428   1              LCD_CmdWrite(WLCR);
 429   1              LCD_DataWrite(temp);     
 430   1      }
 431          
 432          /***************************************************************************/
 433          // 液晶数据反白输入
 434          // 参数：无
 435          // 返回值：无
 436          /***************************************************************************/
 437          void LCD_Inv(void)
 438          {
 439   1              uchar temp;     
 440   1              temp=LCD_CmdRead(0x10);
 441   1              temp |=0x20;
 442   1              LCD_CmdWrite(0x10);
 443   1              LCD_DataWrite(temp); 
 444   1      }
 445          
 446          /***************************************************************************/
 447          // 液晶数据正常输入
 448          // 参数：无
 449          // 返回值：无
 450          /***************************************************************************/
 451          void LCD_NoInv(void)
 452          {
 453   1              uchar temp;     
 454   1              temp=LCD_CmdRead(WCCR);
 455   1              temp &=0xdf;
 456   1              LCD_CmdWrite(WCCR);
 457   1              LCD_DataWrite(temp); 
 458   1      }
 459          
 460          /***************************************************************************/
 461          // 液晶字符放大i倍
 462          // 参数：放大倍数1~4
 463          // 返回值：无
 464          /***************************************************************************/
 465          void enlarge(uchar i)
 466          {  
 467   1              switch(i)
 468   1              {
 469   2                      case 0x01:
 470   2                              LCD_CmdWrite(FVHT);
 471   2                              LCD_DataWrite(0x00);  
 472   2                      break;
 473   2                      case 0x02:
 474   2                              LCD_CmdWrite(FVHT);
 475   2                              LCD_DataWrite(0x50);  
 476   2                      break;
 477   2                      case 0x03:
 478   2                              LCD_CmdWrite(FVHT);
 479   2                              LCD_DataWrite(0xa0); 
 480   2                      break;
 481   2                      case 0x04:
 482   2                              LCD_CmdWrite(FVHT);
 483   2                              LCD_DataWrite(0xf0); 
 484   2                      break;
 485   2              }
 486   1      }
 487          
 488          /***************************************************************************/
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 9   

 489          // 液晶画一个表格
 490          // 参数：无
 491          // 返回值：无
 492          /***************************************************************************/
 493          void display_biao(void)
 494          {
 495   1              uint n0,n1;
 496   1              LCD_Graphic();   //选择绘图模式
 497   1              LCD_GotoXY(0x00,0x00);   //设定X,Y坐标位置
 498   1              LCD_CmdWrite(MWCR);
 499   1              for(n0=0;n0<40;n0++)
 500   1              {
 501   2                      LCD_DataWrite(0xff);
 502   2              }
 503   1              for(n0=0;n0<31;n0++)            
 504   1              {
 505   2                      for(n1=0;n1<40;n1++)
 506   2                      {
 507   3                              if (n1==0) LCD_DataWrite(0x80);
 508   3                              else if (n1==39) LCD_DataWrite(0x01);
 509   3                              else LCD_DataWrite(0x00);
 510   3                      }
 511   2              }
 512   1              for(n0=0;n0<40;n0++)
 513   1              {
 514   2                      LCD_DataWrite(0xff);
 515   2              }
 516   1              for(n0=0;n0<(125);n0++)         
 517   1              {
 518   2                      for(n1=0;n1<40;n1++)
 519   2                      {
 520   3                              if (n1==0)          LCD_DataWrite(0x80);
 521   3                              else if (n1==39) LCD_DataWrite(0x01);
 522   3                              else                LCD_DataWrite(0x00);
 523   3                      }
 524   2              }
 525   1              for(n0=0;n0<40;n0++)
 526   1              {
 527   2                      LCD_DataWrite(0xff);
 528   2              }
 529   1      }
 530          
 531          /***************************************************************************/
 532          // 液晶在指定的坐标处显示字符串
 533          // 参数：x坐标  y坐标  字符串内容
 534          // 返回值：无
 535          /***************************************************************************/
 536          void LCD_ShowStr(uchar xxx,uchar yyy,uchar *text)
 537          { 
 538   1              LCD_Text();   //选择文本模式
 539   1              LCD_GotoXY(xxx,yyy);   //设定X,Y坐标位置 
 540   1              LCD_CmdWrite(MWCR);
 541   1              while(*text != '\0')          
 542   1              {
 543   2                      LCD_DataWrite(*text++);
 544   2              }
 545   1      }
 546          
 547          /***************************************************************************/
 548          // 液晶在指定的坐标处显示字符
 549          // 参数：x坐标  y坐标  字符
 550          // 返回值：无
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 10  

 551          /***************************************************************************/
 552          void LCD_ShowChar(uchar xxx,uchar yyy,uchar text)
 553          { 
 554   1              LCD_Text();   //选择文本模式
 555   1              LCD_GotoXY(xxx,yyy);   //设定X,Y坐标位置 
 556   1              LCD_CmdWrite(MWCR);
 557   1              LCD_DataWrite(text);
 558   1      }
 559          
 560          /***************************************************************************/
 561          // 液晶显示中文字库和字符
 562          // 参数：
 563          // 返回值：无
 564          /***************************************************************************/
 565          void display_word(const uchar *cha, int count )
 566          {
 567   1              uint iiii=0;
 568   1              LCD_Text();  //选择文本模式
 569   1              LCD_GotoXY(0x00,0x00);   //设定X,Y坐标位置 
 570   1              LCD_CmdWrite(MWCR); 
 571   1              for(iiii=0;iiii<count;iiii++)
 572   1              {
 573   2                      LCD_DataWrite(*cha++);
 574   2              }   
 575   1      }
 576          
 577          /***************************************************************************/
 578          // 显示一行边框
 579          // 参数：x起始坐标0~39  y起始坐标0~239  宽度  高度 颜色1正常2反白  
 580          // 返回值：无
 581          /***************************************************************************/
 582          void display_kuang(uchar x_star,uchar y_star,uchar w,uchar h, uchar color)
 583          {
 584   1              uchar width,heigh;      //i表示行,j表示列
 585   1              LCD_Graphic();   //选择绘图模式
 586   1              for(heigh=0;heigh<h;heigh++)
 587   1              {  
 588   2                      if(heigh==0)
 589   2                      {
 590   3                              LCD_GotoXY(x_star,y_star+heigh);   //设定X,Y开始坐标位置  
 591   3                              for(width=0;width<w;width++)
 592   3                              { 
 593   4                                      LCD_CmdWrite(MWCR); 
 594   4                                      LCD_DataWrite(0xff);
 595   4                              }
 596   3                      }
 597   2                      else if((heigh>0)&&(heigh<(h-1)))
 598   2                      {
 599   3                              LCD_GotoXY(x_star,y_star+heigh);   //设定X,Y开始坐标位置    
 600   3                              LCD_CmdWrite(MWCR);   
 601   3                              if(color)
 602   3                              {
 603   4                                      LCD_DataWrite(0x80);
 604   4                                      for(width=1;width<(w-1);width++)
 605   4                                      {
 606   5                                              LCD_DataWrite(0x00);
 607   5                                      }
 608   4                                      LCD_DataWrite(0x01);
 609   4                              }
 610   3                              else
 611   3                              {
 612   4                                      LCD_DataWrite(0xff);
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 11  

 613   4                                      for(width=1;width<(w-1);width++)
 614   4                                      {
 615   5                                              LCD_DataWrite(0xff);
 616   5                                      }
 617   4                                      LCD_DataWrite(0xff);                            
 618   4                              }
 619   3                      }
 620   2                      else if(heigh==(h-1))
 621   2                      {
 622   3                              LCD_GotoXY(x_star,y_star+heigh);   //设定X,Y开始坐标位置  
 623   3                              for(width=0;width<w;width++)
 624   3                              {      
 625   4                                      LCD_CmdWrite(MWCR);
 626   4                                      LCD_DataWrite(0xff);
 627   4                              }
 628   3                      }
 629   2              }
 630   1      }       
 631          
 632          /***************************************************************************/
 633          // 显示图片
 634          // 参数：x_star:0~39;y_star:0~239 w:0~39;h:0~239 
 635          // 返回值：无
 636          /***************************************************************************/
 637          void drow_picture(uchar x, uchar y, uchar w, uchar h, uchar *pData)
 638          {
 639   1              uchar i, j;
 640   1              LCD_Graphic(); 
 641   1              for(i=0;i<h;i++)
 642   1              {
 643   2                      for(j=0; j<w; j++)
 644   2                      {
 645   3                              LCD_GotoXY(x+j,y+i); 
 646   3                              LCD_CmdWrite(MWCR);   
 647   3                              LCD_DataWrite(*pData++); 
 648   3                      }
 649   2              }
 650   1      }
 651          
 652          /***************************************************************************/
 653          // 绘点函数
 654          // 参数：x坐标 y坐标
 655          // 返回值：无
 656          /***************************************************************************/
 657          void drow_point(uint x, uint y)
 658          {
 659   1              uchar temp, temp1= x/8;
 660   1              LCD_Graphic();
 661   1              LCD_GotoXY(temp1,y); 
 662   1              LCD_CmdWrite(MRCR);     //内存读出 
 663   1              temp = LCD_DataRead();
 664   1              LCD_GotoXY(temp1,y); 
 665   1              LCD_CmdWrite(MWCR);   
 666   1              LCD_DataWrite(temp | (1<<7-x%8)); 
 667   1      }
 668          
 669          /***************************************************************************/
 670          // 绘横线函数
 671          // 参数：x起始坐标 y起始坐标 x终止坐标
 672          // 返回值：无
 673          /***************************************************************************/
 674          void drow_row_line(uint x0, uint y0, uint x1)
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 12  

 675          {
 676   1              uint temp;
 677   1              if(x0>x1)
 678   1              {
 679   2                      temp = x1;
 680   2                      x1 = x0;
 681   2                      x0 = temp;
 682   2              }
 683   1              while(x1>=x0)
 684   1              {
 685   2                      drow_point(x0, y0);
 686   2                      x0++;
 687   2              }
 688   1      }
 689          
 690          /***************************************************************************/
 691          // 绘竖线函数
 692          // 参数：x起始坐标 y起始坐标 y终止坐标
 693          // 返回值：无
 694          /***************************************************************************/
 695          void drow_column_line(uint x0, uint y0, uint y1)
 696          {
 697   1              uint temp;
 698   1              if(y0>y1)
 699   1              {
 700   2                      temp = y1;
 701   2                      y1 = y0;
 702   2                      y0 = temp;
 703   2              }
 704   1              do
 705   1              {
 706   2                      drow_point(x0, y0);
 707   2                      y0++;
 708   2              }
 709   1              while(y1>=y0);
 710   1      }
 711          
 712          /***************************************************************************/
 713          // 绘制圆角矩形
 714          // 参数：x起始坐标 y起始坐标 宽度 高度 颜色1正常2反白
 715          // 返回值：无
 716          /***************************************************************************/
 717          void display_r_kuang(uchar x_star,uchar y_star,uchar w,uchar h,uchar color)
 718          {
 719   1              if(color)
 720   1              {
 721   2                      display_kuang(x_star,y_star,w,h,1);
 722   2                      drow_picture(x_star, y_star, 1, 8, RoundedTLB);
 723   2                      drow_picture(x_star,  y_star+h-8, 1, 8, RoundedBLB);
 724   2                      drow_picture(x_star+w-1, y_star, 1, 8, RoundedTRB);
 725   2                      drow_picture(x_star+w-1, y_star+h-8, 1, 8, RoundedBRB);
 726   2              }
 727   1              else
 728   1              {
 729   2                      display_kuang(x_star,y_star,w,h,0);
 730   2                      drow_picture(x_star, y_star, 1, 8, RoundedTLF);
 731   2                      drow_picture(x_star,  y_star+h-8, 1, 8, RoundedBLF);
 732   2                      drow_picture(x_star+w-1, y_star, 1, 8, RoundedTRF);
 733   2                      drow_picture(x_star+w-1, y_star+h-8, 1, 8, RoundedBRF);         
 734   2              }
 735   1      }
 736          
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 13  

 737          /***************************************************************************/
 738          // 绘制左侧圆角矩形
 739          // 参数：x起始坐标 y起始坐标 宽度 高度 颜色1正常2反白
 740          // 返回值：无
 741          /***************************************************************************/
 742          void display_rl_kuang(uchar x_star,uchar y_star,uchar w,uchar h,uchar color)
 743          {
 744   1              if(color)
 745   1              {
 746   2                      display_kuang(x_star,y_star,w,h,1);
 747   2                      drow_picture(x_star, y_star, 1, 8, RoundedTLB);
 748   2                      drow_picture(x_star,  y_star+h-8, 1, 8, RoundedBLB);
 749   2              }
 750   1              else
 751   1              {
 752   2                      display_kuang(x_star,y_star,w,h,0);
 753   2                      drow_picture(x_star, y_star, 1, 8, RoundedTLF);
 754   2                      drow_picture(x_star,  y_star+h-8, 1, 8, RoundedBLF);
 755   2              }
 756   1      }
 757          
 758          /***************************************************************************/
 759          // 绘制右侧圆角矩形
 760          // 参数：x起始坐标 y起始坐标 宽度 高度 颜色1正常2反白
 761          // 返回值：无
 762          /***************************************************************************/
 763          void display_rr_kuang(uchar x_star,uchar y_star,uchar w,uchar h,uchar color)
 764          {
 765   1              if(color)
 766   1              {
 767   2                      display_kuang(x_star,y_star,w,h,1);
 768   2                      drow_picture(x_star+w-1, y_star, 1, 8, RoundedTRB);
 769   2                      drow_picture(x_star+w-1, y_star+h-8, 1, 8, RoundedBRB);
 770   2              }
 771   1              else
 772   1              {
 773   2                      display_kuang(x_star,y_star,w,h,0);
 774   2                      drow_picture(x_star+w-1, y_star, 1, 8, RoundedTRF);
 775   2                      drow_picture(x_star+w-1, y_star+h-8, 1, 8, RoundedBRF);         
 776   2              }
 777   1      }
 778          
 779          /***************************************************************************/
 780          // 允许触摸屏
 781          // 参数：无
 782          // 返回值：无
 783          /***************************************************************************/
 784          void Enable_TP(void)
 785          {
 786   1              uchar temp;
 787   1              temp=LCD_CmdRead(TPCR1);
 788   1              temp|=0x80;
 789   1              LCD_CmdWrite(TPCR1);
 790   1              LCD_DataWrite(temp);
 791   1      }
 792          
 793          /***************************************************************************/
 794          // 允许触摸屏非中断方式
 795          // 参数：无
 796          // 返回值：无
 797          /***************************************************************************/
 798          void Enable_Maunal_TP(void)
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 14  

 799          {
 800   1              uchar temp;
 801   1              temp=LCD_CmdRead(TPCR2);
 802   1              temp|=0x80;
 803   1              LCD_CmdWrite(TPCR2);
 804   1              LCD_DataWrite(temp);
 805   1      }
 806          
 807          /***************************************************************************/
 808          // 允许触摸屏中断方式
 809          // 参数：无
 810          // 返回值：无
 811          /***************************************************************************/
 812          void Enable_interrput_TP(void)
 813          {
 814   1              uchar temp;
 815   1              temp=LCD_CmdRead(INTR);
 816   1              temp|=0x10;
 817   1              LCD_CmdWrite(INTR);
 818   1              LCD_DataWrite(temp);
 819   1      }
 820          
 821          /***************************************************************************/
 822          // 禁用触摸屏中断
 823          // 参数：无
 824          // 返回值：无
 825          /***************************************************************************/
 826          void Disable_interrput_TP(void)
 827          {
 828   1              uchar temp;
 829   1              temp=LCD_CmdRead(INTR);
 830   1              temp&=0xef;
 831   1              LCD_CmdWrite(INTR);
 832   1              LCD_DataWrite(temp);
 833   1      }
 834          
 835          /***************************************************************************/
 836          // 
 837          // 参数：无
 838          // 返回值：无
 839          /***************************************************************************/
 840          void Switch_Latch_X_data(void)
 841          {
 842   1              uchar temp;
 843   1              temp=LCD_CmdRead(TPCR2);
 844   1              temp&=0xFE;
 845   1              temp|=0x02;
 846   1              LCD_CmdWrite(TPCR2);
 847   1              LCD_DataWrite(temp);
 848   1      }
 849          
 850          /***************************************************************************/
 851          // 
 852          // 参数：无
 853          // 返回值：无
 854          /***************************************************************************/
 855          void Switch_Latch_Y_data(void)
 856          {
 857   1              uchar temp;
 858   1              temp=LCD_CmdRead(TPCR2);
 859   1              temp|=0x01;
 860   1              temp|=0x02;
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 15  

 861   1              LCD_CmdWrite(TPCR2);
 862   1              LCD_DataWrite(temp);
 863   1      }
 864          
 865          /***************************************************************************/
 866          // x坐标值转换
 867          // 参数：无
 868          // 返回值：无
 869          /***************************************************************************/
 870          uint trans_tpx(uint x)
 871          {
 872   1              long tp_x;
 873   1              long temp;
 874   1              temp=(((long)x)-x_tps0)*320;
 875   1              tp_x=temp/x_tps;
 876   1              return tp_x;
 877   1      }
 878          
 879          /***************************************************************************/
 880          // y坐标值转换
 881          // 参数：无
 882          // 返回值：无
 883          /***************************************************************************/
 884          uint trans_tpy(uint y)
 885          {
 886   1              long tp_y;
 887   1              long temp;
 888   1              temp=(((long)y)-y_tps0)*240;
 889   1              tp_y=temp/y_tps;
 890   1              return tp_y;
 891   1      }
 892          
 893          /***************************************************************************/
 894          // 获取触摸屏值
 895          // 参数：触摸x坐标 触摸y坐标
 896          // 返回值：result_data
 897          //                                              0无触摸 
 898          //                                              1主界面定时设置 
 899          //                                              2主界面手自动 
 900          //                                              3主界面下班按键 
 901          //                                              4主界面关机状态取消下班 
 902          //                                              5设置界面一号槽选中  
 903          //                                              6设置界面二号槽选中 
 904          //                                              7设置界面三号槽选中 
 905          //                                              8设置界面四号槽选中  
 906          //                                              9设置界面五号槽选中  
 907          //                                              10设置界面六号槽选中
 908          //                                              11设置界面加一分钟
 909          //                                              12设置界面减一分钟
 910          //                                              13设置界面保存
 911          //                                              14设置界面返回
 912          //                                              15设置取消界面返回
 913          /***************************************************************************/
 914          uchar getTP_Value(uint x_temp, uint y_temp)
 915          {
 916   1              uchar result_data = 0;
 917   1              if(displayMode == MainDisplayMode) //主界面正常显示
 918   1              {
 919   2                      if(x_temp>0 && x_temp<96 && y_temp>208 && y_temp<240) //定时设置
 920   2                      {
 921   3                              if(runMode == ManualMode)
 922   3                              {
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 16  

 923   4                                      result_data = 1;
 924   4                              }
 925   3                      }
 926   2                      else if(x_temp>104 && x_temp<208 && y_temp>208 && y_temp<240) //手自动
 927   2                      {
 928   3                              result_data = 2;
 929   3                      }
 930   2                      else if(x_temp>216 && x_temp<312 && y_temp>208 && y_temp<240) //下班按键
 931   2                      {
 932   3                              if(runMode == AutoMode) //只有自动模式下面才能点击下班按钮
 933   3                              {
 934   4                                      result_data = 3;
 935   4                              }
 936   3                      }
 937   2              }
 938   1              else if(displayMode == PowerOffing) //主界面正在关机
 939   1              {
 940   2                      if(x_temp>216 && x_temp<312 && y_temp>208 && y_temp<240) //取消下班
 941   2                      {
 942   3                              result_data = 4;
 943   3                      }
 944   2              }
 945   1              else if(displayMode == Setting) //设置界面正常显示
 946   1              {
 947   2                      if(x_temp>40 && x_temp<72 && y_temp>74 && y_temp<174) //一号槽选中 
 948   2                      {
 949   3                              result_data = 5;
 950   3                      }
 951   2                      else if(x_temp>80 && x_temp<112 && y_temp>74 && y_temp<174) //二号槽选中 
 952   2                      {
 953   3                              result_data = 6;
 954   3                      }
 955   2                      else if(x_temp>120 && x_temp<152 && y_temp>74 && y_temp<174) //三号槽选中 
 956   2                      {
 957   3                              result_data = 7;
 958   3                      }
 959   2                      else if(x_temp>160 && x_temp<192 && y_temp>74 && y_temp<174) //四号槽选中  
 960   2                      {
 961   3                              result_data = 8;
 962   3                      }
 963   2                      else if(x_temp>200 && x_temp<232 && y_temp>74 && y_temp<174) //五号槽选中  
 964   2                      {
 965   3                              result_data = 9;
 966   3                      }
 967   2                      else if(x_temp>240 && x_temp<272 && y_temp>74 && y_temp<174) //六号槽选中
 968   2                      {
 969   3                              result_data = 10;
 970   3                      }
 971   2                      else if(x_temp>160 && x_temp<216 && y_temp>12 && y_temp<60) //加一分钟
 972   2                      {
 973   3                              result_data = 11;
 974   3                      }
 975   2                      else if(x_temp>232 && x_temp<288 && y_temp>12 && y_temp<60) //减一分钟
 976   2                      {
 977   3                              result_data = 12;
 978   3                      }
 979   2                      else if(x_temp>112 && x_temp<208 && y_temp>208 && y_temp<240) //保存
 980   2                      {
 981   3                              result_data = 13;
 982   3                      }
 983   2                      else if(x_temp>216 && x_temp<312 && y_temp>208 && y_temp<240) //返回
 984   2                      {
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 17  

 985   3                              result_data = 14;
 986   3                      }
 987   2              }
 988   1              else if(displayMode == SettingSaved)//设置保存成功
 989   1              {
 990   2                      if(x_temp>216 && x_temp<312 && y_temp>208 && y_temp<240) //返回
 991   2                      {
 992   3                              result_data = 15;
 993   3                      }
 994   2              }
 995   1              return result_data;
 996   1      }
 997          
 998          /***************************************************************************/
 999          // 手动模式轮询测试触摸屏
1000          // 参数：无
1001          // 返回值：result_data 
1002          /***************************************************************************/
1003          uchar tp_ManualMode()
1004          {
1005   1              uchar Touch_Sta_Valid,INT_Sta,count,X1,Y1,X2,Y2,temp,result_data=0;
1006   1              uint X,Y,x_temp,y_temp;
1007   1              Touch_Sta_Valid=0;
1008   1              LCD_CmdWrite(TPCR2);
1009   1              LCD_DataWrite(0x81);
1010   1              LCD_CmdWrite(0xff); 
1011   1              LCD_DataWrite(0xff);  //写这段语句的意思是利用写数据时的判忙来确定此时ra8806是否处于内部工作状态
1012   1              INT_Sta=LCD_CmdRead(INTR);
1013   1              if((INT_Sta&0x08)==0x08)
1014   1              {
1015   2                      for(count=0;count<50;count++)
1016   2                      {
1017   3                              INT_Sta=LCD_CmdRead(INTR);
1018   3                              if(INT_Sta==0)
1019   3                              {
1020   4                                      Touch_Sta_Valid=0;
1021   4                                      break;
1022   4                              }
1023   3                              if(count==49)
1024   3                              {
1025   4                                      Touch_Sta_Valid=1;
1026   4                              }
1027   3                      }
1028   2                      if(Touch_Sta_Valid)
1029   2                      {
1030   3                              Switch_Latch_X_data();
1031   3                              delay_us(100);
1032   3                              Switch_Latch_Y_data();  
1033   3                              delay_us(100);
1034   3                              X1=LCD_CmdRead(TPXR);
1035   3                              LCD_CmdWrite(0xff); 
1036   3                              LCD_DataWrite(0xff);
1037   3                              Y1=LCD_CmdRead(TPYR);
1038   3                              LCD_CmdWrite(0xff); 
1039   3                              LCD_DataWrite(0xff);
1040   3                              X2=LCD_CmdRead(TPZR)&0x03;
1041   3                              LCD_CmdWrite(0xff); 
1042   3                              LCD_DataWrite(0xff);
1043   3                              Y2=LCD_CmdRead(TPZR)&0x0c;
1044   3                              LCD_CmdWrite(0xff); 
1045   3                              LCD_DataWrite(0xff);
1046   3                              X = (((unsigned int)X1&0x00ff)<<2) | ((unsigned int)X2&0x0003);
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 18  

1047   3                              Y = (((unsigned int)Y1&0x00ff)<<2) | (((unsigned int)Y2&0x000C) >> 2);
1048   3                              if((X<948)&&(X>94)&&(Y<944)&&(Y>92))
1049   3                              {
1050   4                                      x_temp=trans_tpx(X);
1051   4                                      y_temp=trans_tpy(Y);
1052   4                                      result_data = getTP_Value(x_temp, y_temp);
1053   4                              }
1054   3                      }
1055   2                      temp=LCD_CmdRead(INTR)&0xfe;
1056   2                      LCD_CmdWrite(INTR);
1057   2                      LCD_DataWrite(temp);
1058   2              }
1059   1              return result_data;
1060   1      }
1061          
1062          /***************************************************************************/
1063          // 显示设置界面
1064          // 参数：0正常设置  1保存成功提示  2保存失败提示 3正在保存提示
1065          // 返回值：无
1066          /***************************************************************************/
1067          void SettingDisplay(uchar settingStatus)
1068          {       
1069   1              uchar i, currentTimeCount;
1070   1              Access_Page2(); //存取DDRAM2
1071   1              clear(); 
1072   1              //加减时间按钮
1073   1              display_r_kuang(20,12,7,48,1);
1074   1              display_r_kuang(29,12,7,48,1);
1075   1              //设置槽框
1076   1              for(i=0; i<8; i++)
1077   1              {
1078   2                      if(cistern[i].isCurrentlSetting)
1079   2                      {
1080   3                              display_kuang(i*5,74,4,100,0);
1081   3                      }
1082   2                      else
1083   2                      {
1084   3                              display_kuang(i*5,74,4,100,1);
1085   3                      }
1086   2              }
1087   1              //按建
1088   1              if(displayMode == Setting)
1089   1              {
1090   2                      display_r_kuang(14,208,12,32,1);
1091   2              }
1092   1              display_r_kuang(27,208,12,32,1);
1093   1              //提示框
1094   1              if(settingStatus)
1095   1              {
1096   2                      display_r_kuang(9,72,22,64,1);  //保存成功提示
1097   2              }
1098   1      
1099   1              Access_Page1(); //存取DDRAM1
1100   1              clear();
1101   1              normal_data();
1102   1              LCD_NoInv();
1103   1              //标题
1104   1              LCD_ShowStr(1,8,"定时设置:");
1105   1              //加减时间按钮
1106   1              LCD_ShowStr(21,18,"加 一");
1107   1              LCD_ShowStr(21,38,"分 钟");
1108   1              LCD_ShowStr(30,18,"减 一");
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 19  

1109   1              LCD_ShowStr(30,38,"分 钟");
1110   1              //设置槽框
1111   1              LCD_ShowStr(1,96,"未");
1112   1              LCD_ShowStr(1,116,"设");
1113   1              LCD_ShowStr(1,136,"置");
1114   1              //设置槽框
1115   1              for(i=1; i<7; i++)
1116   1              {
1117   2                      currentTimeCount = cistern[i].perSettingTime/60;
1118   2                      LCD_ShowChar(1+5*i,96,currentTimeCount/10+48);
1119   2                      LCD_ShowChar(2+5*i,96,currentTimeCount%10+48);
1120   2                      LCD_ShowStr(1+5*i,116,"分");
1121   2                      LCD_ShowStr(1+5*i,136,"钟");
1122   2              }
1123   1              LCD_ShowStr(36,96,"未");
1124   1              LCD_ShowStr(36,116,"设");
1125   1              LCD_ShowStr(36,136,"置");
1126   1              //槽号
1127   1              LCD_ShowStr(1,180,"进");
1128   1              LCD_ShowStr(6,180,"1");
1129   1              LCD_ShowStr(11,180,"2");
1130   1              LCD_ShowStr(16,180,"3");
1131   1              LCD_ShowStr(21,180,"4");
1132   1              LCD_ShowStr(26,180,"5");
1133   1              LCD_ShowStr(31,180,"6");
1134   1              LCD_ShowStr(36,180,"出");
1135   1              //按建
1136   1              if(displayMode == Setting)
1137   1              {
1138   2                      LCD_ShowStr(17,216,"保  存");
1139   2              }
1140   1              LCD_ShowStr(30,216,"返  回");
1141   1              //提示
1142   1              if(settingStatus)
1143   1              {
1144   2                      display_r_kuang(9,72,22,64,0);  //保存成功提示
1145   2                      display_kuang(10,80,20,48,1);   //保存成功提示
1146   2                      if(settingStatus == 1)
1147   2                              LCD_ShowStr(14,96,"保 存 成 功");   //保存成功提示
1148   2                      else if(settingStatus == 2)
1149   2                              LCD_ShowStr(14,96,"保 存 失 败");   //保存失败提示
1150   2                      else
1151   2                              LCD_ShowStr(14,96,"保 存 中...");   //保存失败提示
1152   2              }
1153   1      
1154   1              XOR_Two_Layer();//DDRAM1 OR DDRAM2
1155   1              Show_Two_Layer();//DDRAM1与DDRAM2同时显示
1156   1      }
1157          
1158          /***************************************************************************/
1159          // 开机界面
1160          // 参数：无
1161          // 返回值：无
1162          /***************************************************************************/
1163          void PowerOnDisplay()
1164          {
1165   1              Access_Page2();
1166   1              LCD_NoInv();
1167   1              clear();
1168   1              Access_Page1();
1169   1              LCD_NoInv();
1170   1              clear();
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 20  

1171   1              Only_Show_Page1();
1172   1              //enlarge(2);
1173   1              //LCD_ShowStr(0x02,0x00,"慈溪星越纺机配件厂");
1174   1              enlarge(1);
1175   1              LCD_ShowStr(0x04,0x35,"联系人:陆志东");
1176   1              LCD_ShowStr(0x04,0x53,"联系电话: 13567402367");
1177   1      }
1178          
1179          /***************************************************************************/
1180          // 显示主界面
1181          // 参数：0正常显示 1正在关机 2关机成功
1182          // 返回值：无
1183          /***************************************************************************/
1184          void MainDisplay(uchar displayStatus)
1185          {
1186   1              uchar i, currentTimeCount;
1187   1              Access_Page2(); //存取DDRAM2
1188   1              clear(); 
1189   1              //状态显示
1190   1              display_kuang(0,0,8, 32, 1);
1191   1              display_kuang(8,0,8, 32, 1);
1192   1              //机械臂位置显示
1193   1              for(i=0; i<8; i++)
1194   1              {
1195   2                      drow_picture(2+i*5, 42, 1, 8, HollowPrism);     
1196   2                      drow_picture(2+i*5, 58, 1, 8, HollowPrism);     
1197   2              }
1198   1              if(manipulator.currentPosition%2 == 0)
1199   1              {
1200   2                      if(manipulator.manipulatorPosition == Top)
1201   2                      {
1202   3                              drow_picture(2+manipulator.currentPosition/2*5, 42, 1, 8, SolidPrism);
1203   3                      }
1204   2                      else if(manipulator.manipulatorPosition == Bottom)
1205   2                      {
1206   3                              drow_picture(2+manipulator.currentPosition/2*5, 58, 1, 8, SolidPrism);  
1207   3                      }
1208   2              }
1209   1              else
1210   1              {
1211   2                      if(manipulator.manipulatorPosition == Top)
1212   2                      {
1213   3                              drow_picture(4+manipulator.currentPosition/2*5, 42, 1, 8, SolidPrism);
1214   3                      }
1215   2                      else if(manipulator.manipulatorPosition == Bottom)
1216   2                      {
1217   3                              drow_picture(4+manipulator.currentPosition/2*5, 58, 1, 8, SolidPrism);  
1218   3                      }
1219   2              }
1220   1              //槽状态显示
1221   1              for(i=0; i<8; i++)
1222   1              {
1223   2                      if(cistern[i].cisternStatus)
1224   2                      {
1225   3                              display_kuang(5*i,74,4,100,0);  
1226   3                      }
1227   2                      else
1228   2                      {
1229   3                              display_kuang(5*i,74,4,100,1);
1230   3                      }
1231   2              }
1232   1              //按键显示
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 21  

1233   1              if(displayStatus == 0)
1234   1              {
1235   2                      if(runMode == ManualMode)
1236   2                      {
1237   3                              display_r_kuang(0,208,12,32,1); 
1238   3                      }
1239   2                      display_r_kuang(13,208,13,32,1);
1240   2              }
1241   1              if(runMode == AutoMode && displayStatus != 2) //只有自动模式下面才能点击下班按钮
1242   1              {
1243   2                      display_r_kuang(27,208,12,32,1);
1244   2              }
1245   1              
1246   1              //提示信息
1247   1              if(displayStatus)
1248   1              {
1249   2                      display_r_kuang(9,72,22,64,1);
1250   2              }
1251   1      
1252   1              Access_Page1();//存取DDRAM1
1253   1              clear();
1254   1              normal_data();
1255   1              LCD_NoInv();
1256   1              //状态显示
1257   1              LCD_ShowStr(2,8,"状态");
1258   1              if(runMode == AutoMode)
1259   1                      LCD_ShowStr(10,8,"自动");
1260   1              else
1261   1                      LCD_ShowStr(10,8,"手动");
1262   1      
1263   1              //机械臂动作显示
1264   1              LCD_ShowStr(22,8,"机械臂动作:");
1265   1              switch(manipulator.manipulaterStatus)
1266   1              {
1267   2                      case Stop:
1268   2                              LCD_ShowStr(34,8,"空闲");
1269   2                      break;
1270   2                      case GoEntrance:
1271   2                              LCD_ShowStr(34,8,"<---");
1272   2                      break;
1273   2                      case GoOutfall:
1274   2                              LCD_ShowStr(34,8,"--->");
1275   2                      break;
1276   2                      case GoUp:
1277   2                              LCD_ShowStr(34,8,"向上");
1278   2                      break;
1279   2                      case GoDown:
1280   2                              LCD_ShowStr(34,8,"向下");
1281   2                      break;
1282   2                      default:
1283   2                              LCD_ShowStr(34,8,"错误");
1284   2              }
1285   1              //槽状态显示
1286   1              for(i=0; i<8; i++)
1287   1              {
1288   2                      if(cistern[i].cisternStatus == Empty)
1289   2                      {
1290   3                              LCD_ShowStr(1+5*i,100,"空");
1291   3                              LCD_ShowStr(1+5*i,132,"闲");
1292   3                      }
1293   2                      else if(cistern[i].cisternStatus == Ready)
1294   2                      {
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 22  

1295   3                              LCD_ShowStr(1+5*i,100,"就");
1296   3                              LCD_ShowStr(1+5*i,132,"绪");
1297   3                      }
1298   2                      else
1299   2                      {       
1300   3                              if(i != 0 && i != 7)// 进口出口不安时间就绪
1301   3                              {
1302   4                                      currentTimeCount = (cistern[i].settingTime - cistern[i].currentTime)/60;
1303   4                                      LCD_ShowChar(1+5*i,96,currentTimeCount/10+48);
1304   4                                      LCD_ShowChar(2+5*i,96,currentTimeCount%10+48);
1305   4                                      LCD_ShowStr(1+5*i,116,"分");
1306   4                                      LCD_ShowStr(1+5*i,136,"钟");    
1307   4                              }
1308   3                              else
1309   3                              {
1310   4                                      LCD_ShowStr(1+5*i,100,"忙");
1311   4                                      LCD_ShowStr(1+5*i,132,"碌");
1312   4                              }               
1313   3                      }
1314   2              }
1315   1              LCD_ShowStr(1,180,"进");
1316   1              LCD_ShowStr(6,180,"1");
1317   1              LCD_ShowStr(11,180,"2");
1318   1              LCD_ShowStr(16,180,"3");
1319   1              LCD_ShowStr(21,180,"4");
1320   1              LCD_ShowStr(26,180,"5");
1321   1              LCD_ShowStr(31,180,"6");
1322   1              LCD_ShowStr(36,180,"出");
1323   1              //按键显示
1324   1              if(displayStatus == 0)
1325   1              {
1326   2                      if(runMode == ManualMode)
1327   2                      {
1328   3                              LCD_ShowStr(2,216,"定时设置");
1329   3                      }
1330   2                      LCD_ShowStr(15,216,"手动/自动");
1331   2              }
1332   1              if(displayStatus == 1)
1333   1              {
1334   2                      LCD_ShowStr(29,216,"取消下班");
1335   2              }
1336   1              else if(displayStatus == 0 && runMode == AutoMode)//只有自动模式下面才能点击下班按钮
1337   1              {
1338   2                      LCD_ShowStr(29,216,"下班按键");
1339   2              }
1340   1              //提示信息
1341   1              if(displayStatus)
1342   1              {
1343   2                      display_r_kuang(9,72,22,64,0);
1344   2                      display_kuang(10,80,20,48,1);
1345   2                      if(displayStatus == 1)
1346   2                              LCD_ShowStr(14,96,"关 机 中...");
1347   2                      else
1348   2                              LCD_ShowStr(14,96,"关 机 成 功"); 
1349   2              }
1350   1      
1351   1              XOR_Two_Layer();//DDRAM1 OR DDRAM2
1352   1              Show_Two_Layer();//DDRAM1与DDRAM2同时显示
1353   1      }
1354          
1355          /***************************************************************************/
1356          // 机械臂状态刷新
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 23  

1357          // 参数：无
1358          // 返回值：无
1359          /**************************************************************************/
1360          void ManipulatorStatusDisplay(void)
1361          {
1362   1              Access_Page1();//存取DDRAM1
1363   1              normal_data();
1364   1              LCD_NoInv();
1365   1              //机械臂动作显示
1366   1              switch(manipulator.manipulaterStatus)
1367   1              {
1368   2                      case Stop:
1369   2                              LCD_ShowStr(34,8,"空闲");
1370   2                      break;
1371   2                      case GoEntrance:
1372   2                              LCD_ShowStr(34,8,"<---");
1373   2                      break;
1374   2                      case GoOutfall:
1375   2                              LCD_ShowStr(34,8,"--->");
1376   2                      break;
1377   2                      case GoUp:
1378   2                              LCD_ShowStr(34,8,"向上");
1379   2                      break;
1380   2                      case GoDown:
1381   2                              LCD_ShowStr(34,8,"向下");
1382   2                      break;
1383   2                      default:
1384   2                              LCD_ShowStr(34,8,"错误");
1385   2              }
1386   1      }
1387          
1388          /***************************************************************************/
1389          // 触摸按钮反显函数
1390          // 参数：触摸值
1391          // 返回值：无
1392          /***************************************************************************/
1393          void TP_Response(uchar tpValue)
1394          {
1395   1              Access_Page2(); //存取DDRAM2    
1396   1              switch(tpValue)
1397   1              {
1398   2                      case 1:
1399   2                              display_r_kuang(0,208,12,32,0); 
1400   2                      break;
1401   2                      case 2:
1402   2                              display_r_kuang(13,208,13,32,0);
1403   2                      break;
1404   2                      case 3:
1405   2                              display_r_kuang(27,208,12,32,0);
1406   2                      break;
1407   2                      case 4:
1408   2                              display_r_kuang(27,208,12,32,0);
1409   2                      break;
1410   2                      case 11:
1411   2                              display_r_kuang(20,12,7,48,0);
1412   2                      break;
1413   2                      case 12:
1414   2                              display_r_kuang(29,12,7,48,0);
1415   2                      break;
1416   2                      case 13:
1417   2                              display_r_kuang(14,208,12,32,0);
1418   2                      break;
C51 COMPILER V7.50   RA8806                                                                02/25/2014 21:09:09 PAGE 24  

1419   2                      case 14:
1420   2                              display_r_kuang(27,208,12,32,0);
1421   2                      break;
1422   2                      case 15:
1423   2                              display_r_kuang(27,208,12,32,0);
1424   2                      break;
1425   2              }
1426   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   5615    ----
   CONSTANT SIZE    =    764    ----
   XDATA SIZE       =   ----      62
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
